# Tasks: Text Polish Agent Desktop App

- Date: 2026-02-26
- Feature: Text Polish Agent Desktop App

## **Task 1: 項目初始化與基礎架構**

建立 Electron + React 項目的基礎架構，配置開發環境和構建流程。（映射到整體架構需求）

- 1. [x] 初始化 npm 項目並安裝依賴
  - 1.1 [x] 創建 package.json 配置
  - 1.2 [x] 安裝 Electron, React, TypeScript 等核心依賴
  - 1.3 [x] 配置 Vite 作為前端構建工具
- 2. [x] 建立項目目錄結構
  - 2.1 [x] 創建 src/main 目錄（Electron 主進程）
  - 2.2 [x] 創建 src/renderer 目錄（React 前端）
  - 2.3 [x] 創建 src/shared 目錄（共享代碼）
- 3. [x] 配置 TypeScript
  - 3.1 [x] 創建主進程 tsconfig
  - 3.2 [x] 創建渲染進程 tsconfig
  - 3.3 [x] 配置路徑別名

## **Task 2: Electron 主進程開發**

開發 Electron 主進程，處理窗口管理、全局快捷鍵和系統托盤。（映射到 R1.x, R6.x）

- 4. [x] 實現主窗口創建與管理
  - 4.1 [x] 配置窗口屬性（大小、位置、樣式）
  - 4.2 [x] 實現窗口顯示/隱藏邏輯
  - 4.3 [x] 實現點擊外部關閉功能
  - 4.4 [x] 配置浮動窗口屬性（R1.5, R1.6）
  - 4.5 [x] 實現全螢幕應用疊加顯示（macOS NSWindow.Level）
- 5. [x] 實現全局快捷鍵功能（R1.1, R1.2）
  - 5.1 [x] 註冊/註銷快捷鍵 API
  - 5.2 [x] 快捷鍵衝突檢測
  - 5.3 [x] 快捷鍵觸發顯示窗口
- 6. [x] 實現系統托盤功能（R6.x）
  - 6.1 [x] 創建托盤圖標
  - 6.2 [x] 實現托盤菜單
  - 6.3 [x] 點擊托盤顯示窗口
- 7. [x] 實現預加載腳本（IPC 橋樑）
  - 7.1 [x] 暴露配置讀寫 API
  - 7.2 [x] 暴露快捷鍵設置 API
  - 7.3 [x] 暴露剪貼板 API

## **Task 3: 配置管理系統**

實現配置的持久化存儲和讀取。（映射到 R2.x, R4.x）

- 8. [x] 設計配置數據結構
  - 8.1 [x] 定義配置類型接口
  - 8.2 [x] 定義默認配置值
- 9. [x] 實現配置存儲（R2.3, R4.4）
  - 9.1 [x] 使用 electron-store 存儲配置
  - 9.2 [x] 實現配置讀取 API
  - 9.3 [x] 實現配置寫入 API
- 10. [x] 實現 API Key 安全存儲（R2.4）
  - 10.1 [x] 使用 safeStorage 加密敏感信息
  - 10.2 [x] 實現加密/解密邏輯

## **Task 4: React UI 組件開發**

開發用戶界面組件。（映射到 R1.3, R1.4, R3.x, R5.x）

- 11. [x] 創建基礎 UI 組件
  - 11.1 [x] Button 組件
  - 11.2 [x] Input 組件
  - 11.3 [x] Modal 組件
  - 11.4 [x] Toast 提示組件
- 12. [x] 創建主對話窗口（R1.3, R1.4）
  - 12.1 [x] 對話窗口佈局
  - 12.2 [x] 消息列表組件
  - 12.3 [x] 輸入框組件
  - 12.4 [x] 選項按鈕組件
- 13. [x] 創建設置頁面（R2.x, R4.x）
  - 13.1 [x] API 配置表單
  - 13.2 [x] 快捷鍵設置組件
  - 13.3 [x] System Prompt 編輯器
  - 13.4 [x] 重置按鈕
- 14. [x] 創建翻譯結果頁面（R5.x）
  - 14.1 [x] 原文/譯文對照顯示
  - 14.2 [x] 複製按鈕
  - 14.3 [x] 成功提示

## **Task 5: API 服務層**

實現與 OpenAI 格式 API 的通信。（映射到 R3.1, R5.2）

- 15. [x] 實現 API 客戶端
  - 15.1 [x] 創建 HTTP 請求封裝
  - 15.2 [x] 實現流式響應處理
  - 15.3 [x] 錯誤處理和重試邏輯
- 16. [x] 實現聊天 API 調用
  - 16.1 [x] 構建請求參數
  - 16.2 [x] 處理響應數據
  - 16.3 [x] 解析 AI 返回的選項

## **Task 6: AI Agent 邏輯**

實現互動式文字優化的核心邏輯。（映射到 R3.x）

- 17. [x] 設計 Agent 對話流程
  - 17.1 [x] 定義對話狀態機
  - 17.2 [x] 設計消息格式
- 18. [x] 實現文字優化流程（R3.2, R3.3, R3.4）
  - 18.1 [x] 發送用戶輸入並獲取選項
  - 18.2 [x] 處理用戶選擇
  - 18.3 [x] 處理 "Other" 自定義輸入
  - 18.4 [x] 迭代優化直到確認
- 19. [x] 實現翻譯流程（R5.1, R5.2）
  - 19.1 [x] 確認後觸發翻譯
  - 19.2 [x] 顯示翻譯結果

## **Task 7: 狀態管理**

實現前端狀態管理。

- 20. [x] 配置 Zustand 狀態管理
  - 20.1 [x] 創建配置 Store
  - 20.2 [x] 創建對話 Store
  - 20.3 [x] 創建 UI Store
- 21. [x] 實現狀態持久化
  - 21.1 [x] 配置自動保存
  - 21.2 [x] 實現狀態恢復

## **Task 8: 錯誤處理與用戶體驗**

完善錯誤處理和用戶體驗。（映射到 E1-E6）

- 22. [x] 實現錯誤邊界
  - 22.1 [x] 全局錯誤捕獲
  - 22.2 [x] 錯誤提示 UI
- 23. [x] 實現加載狀態
  - 23.1 [x] Loading 動畫
  - 23.2 [x] 禁用狀態處理
- 24. [x] 實現空狀態處理
  - 24.1 [x] API 未配置提示
  - 24.2 [x] 網絡錯誤提示

## **Task 9: 構建與打包**

配置應用打包和分發。

- 25. [x] 配置 electron-builder
  - 25.1 [x] macOS 打包配置
  - 25.2 [x] Windows 打包配置
  - 25.3 [x] 代碼簽名配置
- 26. [x] 配置開發和生產環境
  - 26.1 [x] 開發環境熱重載
  - 26.2 [x] 生產環境優化

## Notes

- 任務順序反映實際實現順序
- 每個主要任務映射回 spec.md 的需求 ID
- 實現後需更新每個複選框的狀態
